https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Closures

â€‹	**å‡½æ•°**ä¸å…¶**è¯æ³•ç¯å¢ƒçš„å¼•ç”¨**å…±åŒæ„æˆé—­åŒ…ã€‚

â€‹	ä½œç”¨ï¼šä¹Ÿå°±æ˜¯è¯´ï¼Œé—­åŒ…å¯ä»¥è®©ä½ ä»å†…éƒ¨å‡½æ•°è®¿é—®å¤–éƒ¨å‡½æ•°ä½œç”¨åŸŸã€‚

### è¯æ³•ä½œç”¨åŸŸ

```js
function f(){
 var name = "Guan";//nameæ˜¯ä¸€ä¸ªè¢«å‡½æ•°åˆ›å»ºçš„å±€éƒ¨å˜é‡
 function displayName(){//displayNameæ˜¯ä¸€ä¸ªå†…éƒ¨å‡½æ•°,æ˜¯ä¸€ä¸ªé—­åŒ…
   alert(name);//ä½¿ç”¨äº†çˆ¶å‡½æ•°ä¸­å£°æ˜çš„å˜é‡
 }
 displayName();
}
f();//alert "Guan"
```

è¯æ³•ä½œç”¨åŸŸ:å˜é‡**å£°æ˜çš„ä½ç½®**ç¡®å®šè¯¥å˜é‡**å¯è¢«å“ªäº›ä½ç½®è®¿é—®**ã€‚åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œnameå˜é‡å¯è¢«displayNameå‡½æ•°è®¿é—®ï¼Œæ‰€ä»¥displayNameå‡½æ•°çš„è¯æ³•ç¯å¢ƒåŒ…æ‹¬nameå˜é‡ã€‚

### **é—­åŒ…**

```js
function f(){
  var name = "Guan";
  function displayName(){
    alert(name);
  }
  return displayName;//å†…éƒ¨å‡½æ•°displayNameè¢«å¤–éƒ¨å‡½æ•°è¿”å›
}
var myName = f();
myName();//è¿è¡Œè¿™æ®µä»£ç å’Œä¹‹å‰çš„ç¤ºä¾‹çš„æ•ˆæœå®Œå…¨ä¸€æ ·ã€‚
```

ç¬¬ä¸€çœ¼çœ‹ä¸Šå»ï¼Œä¹Ÿè®¸ä¸èƒ½ç›´è§‚çš„çœ‹å‡ºè¿™æ®µä»£ç èƒ½å¤Ÿæ­£å¸¸è¿è¡Œã€‚ä¹Ÿè®¸ä½ ä¼šæƒ³ï¼šmyFunc = function(){ alert(name); } ç„¶å myfunc(); æ‰§è¡Œalert(name)ï¼Œè€Œæ­¤æ—¶nameå˜é‡æ˜¯f()å‡½æ•°çš„å±€éƒ¨å˜é‡ï¼Œå› æ­¤ä¸èƒ½è¢«è®¿é—®ã€‚åœ¨å…¶ä»–ä¸€äº›ç¼–ç¨‹è¯­è¨€ä¸­ï¼Œå‡½æ•°ä¸­çš„å±€éƒ¨å˜é‡ä»…åœ¨å‡½æ•°çš„æ‰§è¡ŒæœŸé—´å¯ç”¨ï¼Œå¦‚f()å‡½æ•°ä¸­çš„nameå˜é‡ä»…åœ¨få‡½æ•°è¢«è°ƒç”¨æ—¶ä½¿ç”¨,è°ƒç”¨å®Œæ¯•å³è¢«å†…å­˜é‡Šæ”¾ã€‚ä½†jsä¸å…¶ä»–è¯­è¨€ä¸åŒã€‚

çœŸç›¸æ˜¯ï¼šJavaScriptçš„å‡½æ•°ä¼šå½¢æˆé—­åŒ…ã€‚**é—­åŒ…æ˜¯ç”±<u>å‡½æ•°</u>ä»¥åŠ<u>åˆ›å»ºè¯¥å‡½æ•°æ—¶çš„è¯æ³•ç¯å¢ƒ</u>ç»„åˆè€Œæˆã€‚è¿™ä¸ªç¯å¢ƒåŒ…å«äº†è¿™ä¸ªé—­åŒ…åˆ›å»ºæ—¶æ‰€èƒ½è®¿é—®çš„æ‰€æœ‰å±€éƒ¨å˜é‡ã€‚**åœ¨ç¤ºä¾‹ä¸­ï¼ŒmyFuncæ˜¯æ‰§è¡Œf()å‡½æ•°æ—¶è¿”å›displayNameå‡½æ•°å®ä¾‹çš„å¼•ç”¨ï¼Œè€ŒdisplayNameå®ä¾‹çš„è¯æ³•ä½œç”¨åŸŸä¸­æœ‰nameå˜é‡ï¼Œç”±æ­¤ï¼Œå½“myFuncè¢«è°ƒç”¨æ—¶ï¼Œname ä»å¯è¢«è®¿é—®ã€‚

ğŸ‰‘æ³¨æ„æ˜¯åˆ›å»ºçš„æ—¶å€™ï¼ä¸æ˜¯è°ƒç”¨çš„æ—¶å€™ï¼æ‰€è°“åˆ›å»ºï¼Œå°±æ˜¯ä½ çš„ä»£ç è¢«ç¼–è¯‘å™¨ç¼–åˆ°çš„é‚£ä¸€åˆ»å°±åˆ›å»ºäº†ã€‚

ä¸‹é¢ä¾‹å­ä¸­çš„`add5` å’Œ `add10` éƒ½æ˜¯é—­åŒ…ã€‚å®ƒä»¬å…±äº«ç›¸åŒçš„å‡½æ•°å®šä¹‰ï¼Œä½†æ˜¯ä¿å­˜äº†ä¸åŒçš„è¯æ³•ç¯å¢ƒï¼š

```js
function makeAdd(x){
  return function(y){
		return x+y;
  };
}
var add5 = makeAdd(5);
var add10 = makeAdd(10);
add5(2);//7
add10(2);//12
```

### å®ç”¨çš„é—­åŒ…

é—­åŒ…å¾ˆæœ‰ç”¨ï¼Œå› ä¸ºå®ƒå…è®¸å°†<u>å‡½æ•°</u>ä¸å…¶æ‰€æ“ä½œçš„æŸäº›<u>æ•°æ®</u>(ç¯å¢ƒ)å…³è”èµ·æ¥ã€‚è¿™æ˜¾ç„¶ç±»ä¼¼äºé¢å‘å¯¹è±¡ç¼–ç¨‹ã€‚åœ¨é¢å‘å¯¹è±¡ç¼–ç¨‹ä¸­ï¼Œå¯¹è±¡å…è®¸æˆ‘ä»¬å°†<u>æ–¹æ³•(å‡½æ•°)</u>ä¸<u>å±æ€§(æ•°æ®)</u>ç›¸å…³è”ã€‚

å› æ­¤ï¼Œé€šå¸¸ä½ è¦å†™åªæœ‰ä¸€ä¸ªæ–¹æ³•çš„å¯¹è±¡ï¼Œéƒ½å¯ä»¥ä½¿ç”¨é—­åŒ…ã€‚

ä»¥ä¸‹è¿™ä¸ªä¾‹å­åœ¨é¡µé¢ä¸Šæ·»åŠ ä¸€äº›å¯ä»¥è°ƒæ•´å­—å·çš„æŒ‰é’®ï¼š

```html
<a href="#" id="size-12">12</a>
<a href="#" id="size-14">14</a>
<a href="#" id="size-16">16</a> 
```

```css
body {
  font-family: Helvetica, Arial, sans-serif;
  font-size: 12px;
}

h1 {
  font-size: 1.5em;
}

h2 {
  font-size: 1.2em;
}
```

```js
function makeSizer(size) {
  return function() {
    document.body.style.fontSize = size + 'px';
  };
}

var size12 = makeSizer(12);
var size14 = makeSizer(14);
var size16 = makeSizer(16);
document.getElementById('size-12').onclick = size12;
document.getElementById('size-14').onclick = size14;
document.getElementById('size-16').onclick = size16;
```



### ç”¨é—­åŒ…æ¨¡æ‹Ÿç§æœ‰æ–¹æ³•

ç¼–ç¨‹è¯­è¨€ä¸­ï¼Œæ¯”å¦‚ Javaï¼Œæ˜¯æ”¯æŒå°†æ–¹æ³•å£°æ˜ä¸ºç§æœ‰çš„ï¼Œå³å®ƒä»¬åªèƒ½è¢«åŒä¸€ä¸ªç±»ä¸­çš„å…¶å®ƒæ–¹æ³•æ‰€è°ƒç”¨ã€‚è€Œ JavaScript æ²¡æœ‰è¿™ç§åŸç”Ÿæ”¯æŒï¼Œä½†æˆ‘ä»¬å¯ä»¥ä½¿ç”¨é—­åŒ…æ¥æ¨¡æ‹Ÿç§æœ‰æ–¹æ³•ã€‚ç§æœ‰æ–¹æ³•ä¸ä»…ä»…æœ‰åˆ©äºé™åˆ¶å¯¹ä»£ç çš„è®¿é—®ï¼šè¿˜æä¾›äº†ç®¡ç†å…¨å±€å‘½åç©ºé—´çš„å¼ºå¤§èƒ½åŠ›ï¼Œé¿å…éæ ¸å¿ƒçš„æ–¹æ³•å¼„ä¹±äº†ä»£ç çš„å…¬å…±æ¥å£éƒ¨åˆ†ã€‚

```js
function creatCounter(){
  var count = 0;
  function changeBy(val){
    count += val;
  }
  return {
    increment:function(val){
      changeBy(val);
    },
    decrement:function(val){
        changeBy(val);
    },
    value:function(){
      return count;
    }
  };
}
var counter = creatCounter();
counter.value();//0
counter.increment(3);
counter.value();//3
counter.decrement(5);
counter.value();//-2
```

åœ¨ä¹‹å‰çš„ç¤ºä¾‹ä¸­ï¼Œæ¯ä¸ªé—­åŒ…éƒ½æœ‰å®ƒè‡ªå·±çš„è¯æ³•ç¯å¢ƒï¼›è€Œè¿™æ¬¡æˆ‘ä»¬åªåˆ›å»ºäº†ä¸€ä¸ªè¯æ³•ç¯å¢ƒï¼Œä¸ºä¸‰ä¸ªå‡½æ•°æ‰€å…±äº«ï¼š`Counter.incrementï¼ŒCounter.decrement` å’Œ `Counter.value`ã€‚è¯¥å…±äº«ç¯å¢ƒåˆ›å»ºäºä¸€ä¸ªç«‹å³æ‰§è¡Œçš„åŒ¿åå‡½æ•°ä½“å†…ã€‚è¿™ä¸ªç¯å¢ƒä¸­åŒ…å«ä¸¤ä¸ªç§æœ‰é¡¹ï¼šåä¸º `count` çš„å˜é‡å’Œåä¸º `changeBy` çš„å‡½æ•°ã€‚

å¦‚æœä¸ç†è§£æ²¡å…³ç³»ï¼Œå¯ä»¥å…ˆçœ‹ä¸€ä¸‹è¿™ä¸ªï¼š

```js
function creatCounter(){
  var count = 0;
 
  return {
    increment:function(val){
      count+=val;
    },
    decrement:function(val){
      count-=val;
    },
    value:function(){
      return count;
    }
  };
}
var counter = creatCounter();
counter.value();//0
counter.increment(3);counter.value();//3
counter.decrement(5);counter.value();//-2
```



æˆ‘ä»¬å¯ä»¥æŠŠè¿™ä¸ªå‡½æ•°å‚¨å­˜åœ¨å¦å¤–ä¸€ä¸ªå˜é‡`makeCounter`ä¸­ï¼Œå¹¶ç”¨ä»–æ¥åˆ›å»ºå¤šä¸ªè®¡æ•°å™¨ã€‚è¯·æ³¨æ„ä¸¤ä¸ªè®¡æ•°å™¨ `firstCounter` å’Œ `secondCounter` æ˜¯å¦‚ä½•ç»´æŠ¤å®ƒä»¬å„è‡ªçš„ç‹¬ç«‹æ€§çš„ã€‚æ¯ä¸ªé—­åŒ…éƒ½æ˜¯å¼•ç”¨è‡ªå·±è¯æ³•ä½œç”¨åŸŸå†…çš„å˜é‡ `count` ã€‚

```js
function makeCounter(initialNumber){
  var count = initialNumber;
  function changeBy(val){
    count += val;
  }
  return {
    increment:function(plus){
      changeBy(plus);
    },
    decrement:function(decr){
        changeBy(decr);
    },
    value:function(){
      return count;
    }
  };
}
var firstCounter = makeCounter(10);
var secondCounter = makeCounter(5);

firstCounter.value();
10
secondCounter.value();
5
firstCounter.increment(2);secondCounter.increment(3);
firstCounter.value();
12
secondCounter.value();
8
```

### åœ¨å¾ªç¯ä¸­åˆ›å»ºé—­åŒ…ï¼šä¸€ä¸ªå¸¸è§é”™è¯¯

åœ¨ES5å¼•å…¥letå…³é”®å­—ä¹‹å‰ï¼Œåœ¨å¾ªç¯ä¸­æœ‰ä¸€ä¸ªå¸¸è§çš„é—­åŒ…åˆ›å»ºé—®é¢˜ã€‚

å‚è€ƒè¿™ä¸ªç¤ºä¾‹ï¼š

```html
<p id="help">Helpful notes will appear here</p>
<p>E-mail: <input type="text" id="email" name="email"></p>
<p>Name: <input type="text" id="name" name="name"></p>
<p>Age: <input type="text" id="age" name="age"></p>
```

```js
function showHelp(help){
  document.getElementById('help').innerHtml = help;
}
function setupHelp(){
  //æ•°ç»„ helpText ä¸­å®šä¹‰äº†ä¸‰ä¸ªæœ‰ç”¨çš„æç¤ºä¿¡æ¯ï¼Œæ¯ä¸€ä¸ªéƒ½å…³è”äºå¯¹åº”çš„æ–‡æ¡£ä¸­çš„input çš„ IDã€‚é€šè¿‡å¾ªç¯è¿™ä¸‰é¡¹å®šä¹‰ï¼Œä¾æ¬¡ä¸ºç›¸åº”inputæ·»åŠ äº†ä¸€ä¸ª onfocus  äº‹ä»¶å¤„ç†å‡½æ•°ï¼Œä»¥ä¾¿æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯ã€‚
   var helpText = [
      {'id': 'email', 'help': 'Your e-mail address'},
      {'id': 'name', 'help': 'Your full name'},
      {'id': 'age', 'help': 'Your age (you must be over 16)'}
    ];
  for(var i=0;i<helpText.length;i++){
    var item = helpText[i];//varå£°æ˜ å˜é‡æå‡ å…·æœ‰æ•´ä¸ªå‡½æ•°ä½œç”¨åŸŸ
    document.getElementById(item.id).onfocus = function(){//3ä¸ªé—­åŒ…éƒ½æŒ‡å‘åŒä¸€ä¸ªitemå˜é‡
      showHelp(item.help);
      //ç”±äºå¾ªç¯åœ¨äº‹ä»¶è§¦å‘ä¹‹å‰æ—©å·²æ‰§è¡Œå®Œæ¯•,å˜é‡item(ä¸‰ä¸ªé—­åŒ…å…±äº«)å·²ç»æŒ‡å‘äº†helpTextçš„æœ€åä¸€é¡¹ã€‚
    }
  };
}
setupHelp();//æ— è®ºç„¦ç‚¹åœ¨å“ªä¸ªinputä¸Šï¼Œæ˜¾ç¤ºçš„éƒ½æ˜¯å…³äºageçš„ä¿¡æ¯ã€‚
```

è§£å†³è¿™ä¸ªé—®é¢˜çš„ä¸€ç§æ–¹æ¡ˆæ˜¯ä½¿ç”¨æ›´å¤šçš„é—­åŒ…ï¼šç‰¹åˆ«æ˜¯ä½¿ç”¨å‰é¢æ‰€è¿°çš„å‡½æ•°å·¥å‚ï¼š

```js
function showHelp(help){
  document.getElementById('help').innerHtml = help;
}
function makeHelpCallback(help){
  return function(){
    showHelp(help);
  }
}
function setupHelp(){
	 var helpText = [
      {'id': 'email', 'help': 'Your e-mail address'},
      {'id': 'name', 'help': 'Your full name'},
      {'id': 'age', 'help': 'Your age (you must be over 16)'}
    ];
  for(var i=0;i<helpText.length;i++){
    var item = helpText[i];
    document.getElmentById(item.id).onfocus =  makeHelpCallback(item.help);//è‡ªå·±ç”¨è‡ªå·±çš„è¯æ³•ç¯å¢ƒ
  }
}
```

å¦ä¸€ç§æ–¹æ³•ä½¿ç”¨äº†åŒ¿åé—­åŒ…ï¼š

```js
function showHelp(help) {
  document.getElementById('help').innerHTML = help;
}

function setupHelp() {
  var helpText = [
      {'id': 'email', 'help': 'Your e-mail address'},
      {'id': 'name', 'help': 'Your full name'},
      {'id': 'age', 'help': 'Your age (you must be over 16)'}
    ];

  for (var i = 0; i < helpText.length; i++) {
    (function() {//ä¸‰ä¸ªé—­åŒ…é‡Œçš„itemå˜é‡äº’ä¸å¹²æ‰°
       var item = helpText[i];
       document.getElementById(item.id).onfocus = function() {
         showHelp(item.help);
       }
    })(); // é©¬ä¸ŠæŠŠå½“å‰å¾ªç¯é¡¹çš„itemä¸äº‹ä»¶å›è°ƒç›¸å…³è”èµ·æ¥
  }
}

setupHelp();
```

é¿å…ä½¿ç”¨è¿‡å¤šçš„é—­åŒ…ï¼Œå¯ä»¥ç”¨letå…³é”®è¯ï¼š

```js
function showHelp(help) {
  document.getElementById('help').innerHTML = help;
}

function setupHelp() {
  var helpText = [
      {'id': 'email', 'help': 'Your e-mail address'},
      {'id': 'name', 'help': 'Your full name'},
      {'id': 'age', 'help': 'Your age (you must be over 16)'}
    ];

  for (var i = 0; i < helpText.length; i++) {
    let item = helpText[i];//æ¯ä¸ªé—­åŒ…éƒ½ç»‘å®šäº†å—ä½œç”¨åŸŸçš„å˜é‡ï¼Œè¿™æ„å‘³ç€ä¸å†éœ€è¦é¢å¤–çš„é—­åŒ…ã€‚
    document.getElementById(item.id).onfocus = function() {
      showHelp(item.help);
    }
  }
}

setupHelp();
```

### æ€§èƒ½è€ƒé‡

å¦‚æœä¸æ˜¯æŸäº›ç‰¹å®šä»»åŠ¡éœ€è¦ä½¿ç”¨é—­åŒ…ï¼Œåœ¨å‡½æ•°ä¸­åˆ›å»ºå‡½æ•°æ˜¯ä¸æ˜æ™ºçš„ï¼Œå› ä¸ºé—­åŒ…åœ¨å¤„ç†é€Ÿåº¦å’Œå†…å­˜æ¶ˆè€—æ–¹é¢å¯¹è„šæœ¬æ€§èƒ½å…·æœ‰è´Ÿé¢å½±å“ã€‚

ä¾‹å¦‚ï¼Œåœ¨åˆ›å»ºæ–°çš„å¯¹è±¡æˆ–è€…ç±»æ—¶ï¼Œæ–¹æ³•é€šå¸¸åº”è¯¥å…³è”äºå¯¹è±¡çš„åŸå‹ï¼Œè€Œä¸æ˜¯å®šä¹‰åˆ°å¯¹è±¡çš„æ„é€ å™¨ä¸­ã€‚åŸå› æ˜¯è¿™å°†å¯¼è‡´æ¯æ¬¡æ„é€ å™¨è¢«è°ƒç”¨æ—¶ï¼Œæ–¹æ³•éƒ½ä¼šè¢«é‡æ–°èµ‹å€¼ä¸€æ¬¡ï¼ˆä¹Ÿå°±æ˜¯ï¼Œæ¯ä¸ªå¯¹è±¡çš„åˆ›å»ºï¼‰ã€‚

